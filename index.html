<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>That one whos the imposter game | Pennbrenn.com</title>
<style>
  :root {
    --bg: #0b0f14;
    --panel: #141b24;
    --muted: #9aa6b2;
    --accent: #7ce7ff;
    --text: #ffffff;
    --danger: #ff6b6b;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  }
  .wrap { min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; }
  .card {
    width: 100%; max-width: 720px;
    background: var(--panel); border-radius: 16px; padding: 24px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }
  h1 { font-size: 22px; margin-top: 0; }
  p.lead { color: var(--muted); font-size: 14px; margin-top: 4px; }

  label { font-size: 14px; color: var(--muted); }
  select, input, textarea {
    background: var(--panel);
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
  }
  select:focus, input:focus, textarea:focus {
    outline: none;
    border-color: var(--accent);
  }
  button {
    background: var(--accent);
    color: #000;
    border: none;
    padding: 12px 18px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
  }
  button.ghost {
    background: transparent;
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.15);
  }
  button.danger {
    background: var(--danger);
    color: #fff;
  }
  .controls { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; }
  .center { text-align: center; }
  .big { font-size: 28px; font-weight: 700; margin: 16px 0; }
  .question-box {
    background: #0f1720;
    border-radius: 12px;
    padding: 18px;
    text-align: center;
    min-height: 120px;
    display: flex; align-items: center; justify-content: center;
  }
  .question-text { font-size: 24px; line-height: 1.2; }
  .hidden { display: none; }
  .note { font-size: 13px; color: var(--muted); margin-top: 8px; text-align: center; }
  @media (max-width: 520px) {
    button { width: 100%; }
    .controls { flex-direction: column; }
    .question-text { font-size: 20px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Imposter Q</h1>
    <p class="lead">Dark, minimal party game. Uses one shared <code>questions.json</code> file.</p>

    <!-- Setup -->
    <section id="setup">
      <div class="controls">
        <div style="flex:1">
          <label>Mode</label>
          <select id="mode">
            <option value="number">Number</option>
            <option value="answer">Answer</option>
          </select>
        </div>
        <div>
          <label>Players</label>
          <select id="players"></select>
        </div>
        <div>
          <label>Imposters</label>
          <select id="imposters"></select>
        </div>
        <div style="flex:1">
          <label>Question file base URL</label>
          <input id="rawBase" placeholder="Optional GitHub raw folder URL">
        </div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="startBtn">Start Game</button>
        <button id="addBtn" class="ghost">Add Questions</button>
      </div>
      <p class="note">The file <code>questions.json</code> should contain {"{ \"number\": [...], \"answer\": [...] }"}.</p>
    </section>

    <!-- Player Phase -->
    <section id="playerFlow" class="hidden center">
      <div class="big" id="statusText">Player 1 — ready?</div>
      <div class="question-box">
        <div id="prompt" class="question-text">Press “Show my question” when ready.</div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
        <button id="showQ">Show my question</button>
        <button id="hideQ" class="ghost hidden">Hide my question</button>
        <button id="nextBtn" class="ghost hidden">Next player</button>
      </div>
      <div class="note" id="progressNote"></div>
      <div style="margin-top:16px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap">
        <button id="revealBtn" class="ghost hidden">Reveal Final</button>
        <button id="restart1" class="danger">Restart</button>
      </div>
    </section>

    <!-- Reveal -->
    <section id="reveal" class="hidden center">
      <div class="big">Final Reveal</div>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <button id="showReal">Show Real Question</button>
        <button id="showFake">Show Imposter Question</button>
      </div>
      <div class="question-box" style="margin-top:16px">
        <div id="finalQ" class="question-text">Press a button to reveal.</div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
        <button id="voteBtn" class="ghost">Start Voting</button>
        <button id="restart2" class="danger">Restart</button>
      </div>
    </section>

    <!-- Voting -->
    <section id="voting" class="hidden center">
      <div class="big">Who is the imposter?</div>
      <div id="voteList" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px"></div>
      <div class="note">Tap a player to vote locally.</div>
      <button id="finishBtn" style="margin-top:12px">Reveal Imposters</button>
    </section>

    <!-- Add Question -->
    <section id="addSection" class="hidden">
      <h2>Add a Question</h2>
      <div class="controls">
        <div style="flex:1">
          <label>Mode</label>
          <select id="addMode">
            <option value="number">Number</option>
            <option value="answer">Answer</option>
          </select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label>Real Question</label>
        <textarea id="realInput" rows="2"></textarea>
      </div>
      <div style="margin-top:10px">
        <label>Imposter Question</label>
        <textarea id="fakeInput" rows="2"></textarea>
      </div>
      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="saveQ">Add to list</button>
        <button id="downloadQ" class="ghost">Download Updated JSON</button>
        <button id="backBtn" class="danger">Back</button>
      </div>
      <p class="note">This updates your local list. Use “Download Updated JSON” to save and commit it to GitHub.</p>
    </section>
  </div>
</div>

<script>
const RAW_BASE_URL_DEFAULT = "";
const FILE_NAME = "questions.json";

const fallbackData = {
  number: [
    { real: "How many legs on a spider?", imposter: "How many legs on an ant?" },
    { real: "How many hours in a day?", imposter: "How many hours in a week?" }
  ],
  answer: [
    { real: "Name a fruit that is red", imposter: "Name a vegetable that is red" },
    { real: "Say a word starting with A", imposter: "Say a word starting with Z" }
  ]
};

let data = fallbackData;
let RAW_BASE_URL = RAW_BASE_URL_DEFAULT;

// populate player dropdowns
const playersSel = document.getElementById('players');
for (let i = 2; i <= 12; i++) {
  const o = document.createElement('option');
  o.value = i; o.textContent = i;
  playersSel.appendChild(o);
}
playersSel.value = 4;

const impostersSel = document.getElementById('imposters');
function fillImposters() {
  impostersSel.innerHTML = "";
  const p = parseInt(playersSel.value, 10);
  for (let i = 1; i < p; i++) {
    const o = document.createElement('option');
    o.value = i; o.textContent = i;
    impostersSel.appendChild(o);
  }
  impostersSel.value = 1;
}
playersSel.addEventListener('change', fillImposters);
fillImposters();

async function loadData() {
  const base = (document.getElementById('rawBase').value || RAW_BASE_URL_DEFAULT).trim();
  const urls = base ? [base + FILE_NAME] : ['./' + FILE_NAME, './data/' + FILE_NAME];
  for (const u of urls) {
    try {
      const res = await fetch(u, { cache: "no-store" });
      if (res.ok) { data = await res.json(); return; }
    } catch (e) {}
  }
  data = fallbackData;
}

function pickOne(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// Game state
let players = 4, imposters = 1, imposterSet = new Set(), current = 0;
let chosen = { real: "", imposter: "" };

function startGame() {
  players = parseInt(playersSel.value, 10);
  imposters = parseInt(impostersSel.value, 10);
  imposterSet = new Set();
  while (imposterSet.size < imposters)
    imposterSet.add(Math.floor(Math.random() * players));
  const mode = document.getElementById('mode').value;
  const pool = data[mode] || [];
  const picked = pickOne(pool) || { real: "Missing", imposter: "Missing" };
  chosen = picked;
  current = 0;
  showSection('playerFlow');
  updatePlayerUI();
}

function updatePlayerUI() {
  document.getElementById('statusText').textContent = `Player ${current + 1} — ready?`;
  document.getElementById('prompt').textContent = 'Press “Show my question” when ready.';
  document.getElementById('showQ').classList.remove('hidden');
  document.getElementById('hideQ').classList.add('hidden');
  document.getElementById('nextBtn').classList.add('hidden');
  document.getElementById('revealBtn').classList.add('hidden');
  document.getElementById('progressNote').textContent = `(${current + 1}/${players})`;
}

document.getElementById('showQ').onclick = () => {
  const text = imposterSet.has(current) ? chosen.imposter : chosen.real;
  document.getElementById('prompt').textContent = text;
  document.getElementById('showQ').classList.add('hidden');
  document.getElementById('hideQ').classList.remove('hidden');
  document.getElementById('nextBtn').classList.remove('hidden');
};
document.getElementById('hideQ').onclick = () => {
  document.getElementById('prompt').textContent = "Hide and pass the device.";
  document.getElementById('hideQ').classList.add('hidden');
};
document.getElementById('nextBtn').onclick = () => {
  current++;
  if (current >= players) {
    document.getElementById('prompt').textContent = "All players done.";
    document.getElementById('nextBtn').classList.add('hidden');
    document.getElementById('revealBtn').classList.remove('hidden');
  } else updatePlayerUI();
};
document.getElementById('revealBtn').onclick = () => showSection('reveal');
document.getElementById('showReal').onclick = () => document.getElementById('finalQ').textContent = chosen.real;
document.getElementById('showFake').onclick = () => document.getElementById('finalQ').textContent = chosen.imposter;
document.getElementById('voteBtn').onclick = () => { showSection('voting'); renderVotes(); };
document.getElementById('finishBtn').onclick = () => {
  const sel = voteList.dataset.selection;
  if (sel == null) return alert("No selection made.");
  const s = parseInt(sel, 10);
  const imposters = Array.from(imposterSet).map(i => i + 1).join(', ');
  alert(`You picked Player ${s + 1}. Imposters were: ${imposters}.`);
};

function renderVotes() {
  const c = document.getElementById('voteList');
  c.innerHTML = "";
  for (let i = 0; i < players; i++) {
    const b = document.createElement('button');
    b.textContent = "Player " + (i + 1);
    b.className = 'ghost';
    b.onclick = () => {
      Array.from(c.children).forEach(btn => btn.style.outline = 'none');
      b.style.outline = '2px solid var(--accent)';
      c.dataset.selection = i;
    };
    c.appendChild(b);
  }
}

function showSection(id) {
  ['setup','playerFlow','reveal','voting','addSection'].forEach(s => {
    document.getElementById(s).classList.add('hidden');
  });
  document.getElementById(id).classList.remove('hidden');
}

// Add Question
const addBtn = document.getElementById('addBtn');
addBtn.onclick = () => showSection('addSection');
document.getElementById('backBtn').onclick = () => showSection('setup');
document.getElementById('saveQ').onclick = () => {
  const mode = document.getElementById('addMode').value;
  const real = document.getElementById('realInput').value.trim();
  const fake = document.getElementById('fakeInput').value.trim();
  if (!real || !fake) return alert("Fill both fields.");
  if (!data[mode]) data[mode] = [];
  data[mode].push({ real, imposter: fake });
  document.getElementById('realInput').value = "";
  document.getElementById('fakeInput').value = "";
  alert("Question added locally!");
};
document.getElementById('downloadQ').onclick = () => {
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = FILE_NAME;
  a.click();
};

// Restart buttons
['restart1','restart2'].forEach(id => {
  document.getElementById(id).onclick = () => location.reload();
});

// Start Game
document.getElementById('startBtn').onclick = async () => {
  await loadData();
  startGame();
};
</script>
</body>
</html>
