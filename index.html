<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fun Imposter Game</title>
  <meta name="description" content="A quick guessing game for friends. One question, one imposter, endless laughter.">
  <link rel="icon" type="image/png" href="play.png">
  <style>
    :root {
      --bg: #0d0d0d;
      --text: #f2f2f2;
      --accent: #4b8bff;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }
    button, select, input {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 12px 20px;
      margin: 8px;
      font-size: 1.1em;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #6ea4ff; }
    #game, #player-phase, #reveal-phase { display: none; }
    .question-box {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 20px;
      margin: 20px auto;
      max-width: 500px;
      font-size: 1.4em;
      line-height: 1.4;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Imposter Game</h1>

  <div id="setup">
    <p>Select game mode:</p>
    <select id="mode">
      <option value="number">Number Mode</option>
      <option value="answer">Answer Mode</option>
    </select><br>
    <p>Number of players:</p>
    <input type="number" id="numPlayers" min="2" max="20" value="4"><br>
    <p>Number of imposters:</p>
    <input type="number" id="numImposters" min="1" max="5" value="1"><br>
    <button id="startGame">Start Game</button>
  </div>

  <div id="player-phase">
    <h2 id="playerLabel">Player 1, ready?</h2>
    <div class="question-box hidden" id="questionBox"></div>
    <button id="showBtn">Show My Question</button>
    <button id="hideBtn" class="hidden">Hide My Question</button>
  </div>

  <div id="reveal-phase">
    <h2>Everyone answered!</h2>
    <button id="revealReal">Reveal Real Question</button>
    <button id="revealImposter" class="hidden">Reveal Imposter Question</button>
    <div id="finalBox" class="question-box hidden"></div>
    <button id="restartBtn" class="hidden">Restart Game</button>
  </div>

  <button id="refreshBtn" style="position:fixed;bottom:10px;right:10px;font-size:0.8em;">Refresh Question List</button>

  <script>
    let allQuestions = [];
    let gameMode = "number";
    let numPlayers = 0, numImposters = 0;
    let imposters = [];
    let currentPlayer = 1;
    let realQ = null, impQ = null;

    // Load questions from JSON and cache in localStorage
    async function loadQuestions() {
      try {
        const res = await fetch('questions.json?_=' + Date.now());
        const data = await res.json();
        localStorage.setItem('cachedQuestions', JSON.stringify(data));
        allQuestions = data;
        console.log("Loaded questions from GitHub.");
      } catch (e) {
        console.warn("Could not fetch remote questions, using cache or default.", e);
        const cached = localStorage.getItem('cachedQuestions');
        if (cached) {
          allQuestions = JSON.parse(cached);
        } else {
          allQuestions = [
            { real: "Pick a number from 1–10.", imposter: "Pick a number from 1–20." },
            { real: "What color is the sky?", imposter: "What color is grass?" },
            { real: "How many hours do you sleep?", imposter: "How many naps do you take?" }
          ];
        }
      }
    }

    function startGame() {
      gameMode = document.getElementById("mode").value;
      numPlayers = parseInt(document.getElementById("numPlayers").value);
      numImposters = parseInt(document.getElementById("numImposters").value);
      if (numImposters >= numPlayers) return alert("Imposters must be fewer than players!");

      // Choose random question pair
      const validQs = allQuestions;
      const chosen = validQs[Math.floor(Math.random() * validQs.length)];
      realQ = chosen.real;
      impQ = chosen.imposter;

      // Pick imposters
      imposters = [];
      while (imposters.length < numImposters) {
        let idx = Math.floor(Math.random() * numPlayers) + 1;
        if (!imposters.includes(idx)) imposters.push(idx);
      }

      document.getElementById("setup").style.display = "none";
      document.getElementById("player-phase").style.display = "block";
      updatePlayer();
    }

    function updatePlayer() {
      document.getElementById("playerLabel").innerText = `Player ${currentPlayer}, ready?`;
      document.getElementById("questionBox").classList.add("hidden");
      document.getElementById("showBtn").classList.remove("hidden");
      document.getElementById("hideBtn").classList.add("hidden");
    }

    function showQuestion() {
      const box = document.getElementById("questionBox");
      const isImp = imposters.includes(currentPlayer);
      box.innerText = isImp ? impQ : realQ;
      box.classList.remove("hidden");
      document.getElementById("showBtn").classList.add("hidden");
      document.getElementById("hideBtn").classList.remove("hidden");
    }

    function hideQuestion() {
      const box = document.getElementById("questionBox");
      box.classList.add("hidden");
      if (currentPlayer < numPlayers) {
        currentPlayer++;
        updatePlayer();
      } else {
        endPhase();
      }
    }

    function endPhase() {
      document.getElementById("player-phase").style.display = "none";
      document.getElementById("reveal-phase").style.display = "block";
    }

    function revealReal() {
      const finalBox = document.getElementById("finalBox");
      finalBox.innerText = realQ;
      finalBox.classList.remove("hidden");
      document.getElementById("revealReal").classList.add("hidden");
      document.getElementById("revealImposter").classList.remove("hidden");
    }

    function revealImposter() {
      const finalBox = document.getElementById("finalBox");
      finalBox.innerText = impQ;
      document.getElementById("revealImposter").classList.add("hidden");
      document.getElementById("restartBtn").classList.remove("hidden");
    }

    function restartGame() {
      currentPlayer = 1;
      imposters = [];
      realQ = impQ = null;
      document.getElementById("setup").style.display = "block";
      document.getElementById("player-phase").style.display = "none";
      document.getElementById("reveal-phase").style.display = "none";
      document.getElementById("finalBox").classList.add("hidden");
      document.getElementById("revealReal").classList.remove("hidden");
      document.getElementById("revealImposter").classList.add("hidden");
      document.getElementById("restartBtn").classList.add("hidden");
    }

    // Event Listeners
    document.getElementById("startGame").onclick = startGame;
    document.getElementById("showBtn").onclick = showQuestion;
    document.getElementById("hideBtn").onclick = hideQuestion;
    document.getElementById("revealReal").onclick = revealReal;
    document.getElementById("revealImposter").onclick = revealImposter;
    document.getElementById("restartBtn").onclick = restartGame;
    document.getElementById("refreshBtn").onclick = loadQuestions;

    // Initialize
    loadQuestions();
  </script>
</body>
</html>
